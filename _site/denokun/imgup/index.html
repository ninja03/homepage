<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title></title>
    <link rel="stylesheet" href="/denokun/style.css">
  </head>
  <body>
    <div class="header" onclick="location.href = '.'">
      
    </div>
      <ul>
<li><a href="https://fukuno.jig.jp/2943">ImageUploader</a>を使う
<ul>
<li>画像ファイルはサーバのdataフォルダに保存されURLが返る</li>
</ul>
</li>
<li>画像ファイルを選択するとプレビューを表示する</li>
</ul>
<p><code>static/index.html</code></p>
<pre><code class="language-html">&lt;div x-data=&quot;app&quot;&gt;
  
  &lt;div x-show=&quot;showUpload&quot;&gt;
    &lt;img :src=&quot;preview&quot;&gt;
    ファイル選択
    &lt;input id=&quot;inputFile&quot; @change=&quot;fileSelected&quot; type=&quot;file&quot; required&gt;
    &lt;button @click=&quot;upload()&quot; :class=&quot;buttonStyle&quot;&gt;アップロード&lt;/button&gt;
  &lt;/div&gt;

&lt;/div&gt;

&lt;script type=&quot;module&quot;&gt;
  import Alpine from &quot;https://unpkg.com/alpinejs@3.2.3/dist/module.esm.js&quot;
  import { fetchJSON } from &quot;https://ninja03.github.io/denokun/lib/fetchJSON.js&quot;
  import { ImageUploader } from &quot;https://ninja03.github.io/denokun/lib/ImageUploader.js&quot;

  Alpine.data(&quot;app&quot;, () =&gt; ({
    
    // アップロードするファイルを選んだ
    fileSelected() {
      const reader = new FileReader()
      reader.onload = () =&gt; { this.preview = reader.result }
      reader.readAsDataURL(inputFile.files[0])
    },

    // アップロードする
    upload() {
      const f = inputFile.files[0]
      let up = new ImageUploader(this.server + &quot;/data/&quot;)
      // 最大幅1200px、最大ファイルサイズ1メガバイト
      up.setFile(f, 1200, 1024 * 1024)
      up.onload = async url =&gt; {
        await this.fetchAPI(&quot;post&quot;, { url })
        this.up = f.name
        console.log(&quot;「&quot; + this.up + &quot;をアップしました&quot;)
        this.closeUpload()
        this.reloadTimeline()
      }
    }
  }))

&lt;/script&gt;
</code></pre>

  </body>
</html>